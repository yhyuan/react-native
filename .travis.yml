language: objective-c
before_install:
  - brew update
  - brew reinstall xctool
install:
  - brew install watchman
  - npm install
before_script:
  - npm test
  - (npm start > packager.log 2>&1 &) && echo $! > packager.pid

after_script:
  - pkill -9 -F packager.pid
  - cat packager.log
  - rm packager.log
  - rm packager.pid

# Automatically publish the website
after_success: 'echo "machine github.com login reactjs-bot password $GITHUB_TOKEN" >~/.netrc; (cd website; npm install; ./setup.sh; ./publish.sh)'

env:
  global:
    - secure: "iBEHIQraDdkDkO6GmoOMcqkAB3N4cXYlSxopkdu8Dkwyokui6m/cwxpfWPilCMEeEZ8uXBt9nnrguGW+NA4a4QvANMDVO5CYxKf4X+1BcBN1I21yDDUW6WBLCcdbuGDCcGPcPrD0OoQ3HW9wreIxc/jFPCLoVXp2FHBT0ZwGwXE="

branches:
  only:
    - master
